#include "LCD_lib.h"

void LCD_Init()
{
    LCD_Dir = 0xFF;     // Out chan B
    delay_ms(20);       // Doi LCD len nguon
    
    LCD_Cmd(0x33);      // Muc fuction set
    LCD_Cmd(0x32);      // Mode 4 bit
    LCD_Cmd(0x28);      // 2 dong _ 5x7 dots
    LCD_Cmd(0x0C);      // Hien len man hinh, tat con tro
    LCD_Cmd(0x06);      // Dich con tro                 
    LCD_Cmd(0x01);      // Xoa man hinh    
}

void LCD_Cmd(unsigned char cmd)
{
    LCD_Port = (LCD_Port & 0x0F)|(cmd & 0xF0);      // Gui upper nibble
    RS = 0;        // RS=0 --> command transmit
    EN = 1;        // Enable
    delay_us(1);
    EN = !EN;       
    delay_us(200);  
    LCD_Port = (LCD_Port & 0x0F) | (cmd << 4);      // Gui lower nibble
    EN = 1;
    delay_us(1);
    EN = !EN;
    delay_ms(2);
}

void LCD_Char(unsigned char data) // in ki tu
{
    LCD_Port = (LCD_Port & 0x0F) | (data & 0xF0);
    RS = 1;     // RS=1 --> data transmit
    EN = 1;     
    delay_us(1);
    EN = !EN;      
    delay_us(200);
    LCD_Port = (LCD_Port & 0x0F) | (data << 4);
    EN = 1;
    delay_us(1);
    EN = !EN;
    delay_ms(2);
}

void LCD_String(char *str)  // in chuoi
{
    int i;
    for(i=0;str[i]!=0;i++)
    {
        LCD_Char (str[i]);
    }
}

void LCD_String_xy(char row, char pos, char *str)
{
    if (row == 0 && pos < 16) 
        LCD_Cmd((pos & 0x0F)|0x80); 
    else if (row == 1 && pos <16) 
        LCD_Cmd((pos & 0x0F)|0xC0);
    LCD_String(str);
}

void LCD_Clear()
{
    LCD_Cmd(0x01);      // Xoa
    delay_ms(2);
    LCD_Cmd (0x80); // Pagehome
}

void LCD_Roll_Right(unsigned char times_roll)
{
    unsigned char shift = 15;
    unsigned char i,k;
    for (i=0;i<times_roll;i++)
    {
        for (k=0;k<shift;k++)
        {
            LCD_Cmd(0x1C);
            delay_ms(300);
        }
        for (k=0;k<shift;k++)
        {
            LCD_Cmd(0x18);
        }
        
    }
}